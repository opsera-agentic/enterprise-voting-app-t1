# Skill Manifest - Generated by Opsera Code-to-Cloud v0.6
# This file tracks the skill version used to generate this deployment
# IRSA Enabled - No hardcoded credentials

skill:
  name: unified-code-to-cloud
  version: "0.6.0"
  generated_at: "2026-01-28T00:00:00Z"

configuration:
  app_name: voting2
  environment: dev
  cloud_provider: aws
  region: us-west-2
  tenant: opsera
  setup_mode: quick

security:
  authentication:
    github_actions: OIDC  # No AWS access keys required
    database: IAM_AUTH    # No database passwords required
    pods: IRSA            # IAM Roles for Service Accounts

deployment:
  strategy: rolling
  services:
    - name: vote
      port: 80
      runtime: python
      health_check: /
      irsa_role: voting2-dev-vote-irsa
    - name: result
      port: 80
      runtime: nodejs
      health_check: /
      irsa_role: voting2-dev-result-irsa
    - name: worker
      port: none
      runtime: dotnet
      irsa_role: voting2-dev-worker-irsa

infrastructure:
  hub_cluster: argocd-usw2
  spoke_cluster: opsera-usw2-np
  namespace: voting2-dev

databases:
  postgresql:
    type: rds
    instance_class: db.t3.micro
    engine_version: "15.4"
    iam_authentication: true
    managed_master_password: true
  redis:
    type: elasticache
    node_type: cache.t3.micro
    engine_version: "7.0"

irsa_roles:
  vote: voting2-dev-vote-irsa
  result: voting2-dev-result-irsa
  worker: voting2-dev-worker-irsa
  github_actions: voting2-dev-github-actions

endpoints:
  vote: https://vote-voting2-dev.agent.opsera.dev
  result: https://result-voting2-dev.agent.opsera.dev

generated_files:
  terraform:
    - terraform/main.tf
    - terraform/variables.tf
    - terraform/outputs.tf
    - terraform/dev.tfvars
  kubernetes:
    - k8s/base/namespace.yaml
    - k8s/base/configmap.yaml
    - k8s/base/serviceaccounts.yaml
    - k8s/base/vote-deployment.yaml
    - k8s/base/vote-service.yaml
    - k8s/base/result-deployment.yaml
    - k8s/base/result-service.yaml
    - k8s/base/worker-deployment.yaml
    - k8s/base/ingress.yaml
    - k8s/base/kustomization.yaml
    - k8s/overlays/dev/kustomization.yaml
    - k8s/overlays/dev/patch-replicas.yaml
    - k8s/overlays/dev/patch-ingress.yaml
  argocd:
    - argocd/application.yaml
  workflows:
    - .github/workflows/00-bootstrap-infrastructure.yaml
    - .github/workflows/20-ci-build-push.yaml
  dockerfiles:
    - Dockerfiles/Dockerfile.vote
    - Dockerfiles/Dockerfile.result
    - Dockerfiles/Dockerfile.worker
  scripts:
    - scripts/bootstrap-iam-role.sh
    - scripts/setup-terraform-backend.sh
  documentation:
    - README.md

required_secrets:
  - AWS_ACCOUNT_ID  # Only secret needed - used to construct role ARN

bootstrap_order:
  - step: 1
    name: "Setup Terraform Backend"
    script: scripts/setup-terraform-backend.sh
    description: "Creates S3 bucket and DynamoDB table for Terraform state"
    one_time: true
  - step: 2
    name: "Bootstrap IAM Role"
    script: scripts/bootstrap-iam-role.sh
    description: "Creates GitHub Actions OIDC role"
    one_time: true
  - step: 3
    name: "Add GitHub Secret"
    manual: true
    description: "Add AWS_ACCOUNT_ID secret to GitHub repository"
  - step: 4
    name: "Run Bootstrap Workflow"
    workflow: 00-bootstrap-infrastructure.yaml
    action: apply
    description: "Provisions ECR, RDS, ElastiCache, IRSA"
  - step: 5
    name: "Build and Deploy"
    workflow: 20-ci-build-push.yaml
    description: "Builds images and triggers ArgoCD sync"
